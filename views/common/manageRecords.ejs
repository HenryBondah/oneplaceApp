<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%= title %> - OnePlace</title>
    <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
    <div class="container">
        <fieldset>
            <h1>Manage School Years and Terms</h1>
            <legend>School Years</legend>
            <% schoolYears.forEach(function(year) { %>
                <form action="/common/updateSchoolYearAndTerms" method="post">
                    <input type="hidden" name="yearId" value="<%= year.id %>">
                    <div>
                        <label>School Year:</label>
                        <input type="text" name="year_label" value="<%= year.year_label %>">
                        <label>
                            <input type="checkbox" name="current" value="true" <%= year.current ? 'checked' : '' %>>
                            Current
                        </label>
                    </div>

                    <% year.terms.forEach(function(term, index) { %>
                        <fieldset>
                            <legend>Term <%= index + 1 %></legend>
                            <input type="hidden" name="termIds[]" value="<%= term.term_id %>">
                            <div>
                                <label>Term Name:</label>
                                <input type="text" name="termNames[]" value="<%= term.term_name %>">
                            </div>
                            <div class="date-fields">
                                <div>
                                    <label>Start Date:</label>
                                    <input type="date" name="startDates[]" value="<%= new Date(term.start_date).toISOString().slice(0, 10) %>">
                                </div>
                                <div>
                                    <label>End Date:</label>
                                    <input type="date" name="endDates[]" value="<%= new Date(term.end_date).toISOString().slice(0, 10) %>">
                                </div>
                            </div>
                            <div>
                                <label>
                                    <input type="checkbox" id="selectAll<%= term.term_id %>" onclick="selectAllClasses(<%= term.term_id %>, this)">
                                    Select All Classes
                                </label>
                            </div>
                            <% classes.forEach(cls => { %>
                                <div class="class-checkbox-container">
                                    <label>
                                        <input type="checkbox" name="term<%= term.term_id %>Classes[]" value="<%= cls.class_id %>" <%= (term.classes || []).includes(cls.class_id) ? 'checked' : '' %>>
                                        <%= cls.class_name %>
                                    </label>
                                </div>
                            <% }); %>
                        </fieldset>
                    <% }); %>
                    <button type="submit">Save Changes</button>
                    <a href="#" onclick="deleteSchoolYear(<%= year.id %>)">Delete</a>
                </form>
            <% }); %>
        </fieldset>

        <fieldset>
            <h1>Manage Events</h1>
            <legend>Events</legend>
            <% events.forEach(function(event) { %>
                <form action="/common/updateEvent" method="post">
                    <input type="hidden" name="id" value="<%= event.id %>">
                    <input type="text" name="name" value="<%= event.name %>">
                    <input type="date" name="event_date" value="<%= new Date(event.event_date).toISOString().split('T')[0] %>">
                    <textarea name="details"><%= event.details %></textarea>
                    <button type="submit">Save</button>
                    <a href="#" onclick="deleteEvent(<%= event.id %>)">Delete</a>
                </form>
            <% }); %>
        </fieldset>

        <fieldset>
            <h1>Manage Announcements</h1>
            <legend>Announcements</legend>
            <% announcements.forEach(function(announcement) { %>
                <form action="/common/updateAnnouncement" method="post">
                    <input type="hidden" name="announcementId" value="<%= announcement.announcement_id %>">
                    <textarea name="message"><%= announcement.message %></textarea>
                    <button type="submit">Save</button>
                    <a href="#" onclick="deleteRecord('announcement', <%= announcement.announcement_id %>)">Delete</a>
                </form>
            <% }); %>
        </fieldset>
    </div>

    <script>
        function selectAllClasses(termId, checkbox) {
            const checkboxes = document.querySelectorAll(`input[name="term${termId}Classes[]"]`);
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
        }
    </script>
</body>
</html>
