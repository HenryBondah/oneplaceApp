<body>
    <h1>Manage School Years and Terms</h1>
    <% schoolYears.forEach(function(year) { %>
        <form action="/common/updateSchoolYearAndTerms" method="post">
            <input type="hidden" name="yearId" value="<%= year.id %>">
            <div>
                <label>School Year:</label>
                <input type="text" name="year_label" value="<%= year.year_label %>">
            </div>

            <% year.terms.forEach(function(term, index) { %>
                <fieldset>
                    <legend>Term <%= index + 1 %></legend>
                    <input type="hidden" name="termIds[]" value="<%= term.term_id %>">
                    <div>
                        <label>Term Name:</label>
                        <input type="text" name="termNames[]" value="<%= term.term_name %>">
                    </div>
                    <div class="date-fields">
                        <div>
                            <label>Start Date:</label>
                            <input type="date" name="startDates[]" value="<%= term.start_date.toISOString().slice(0, 10) %>">
                        </div>
                        <div>
                            <label>End Date:</label>
                            <input type="date" name="endDates[]" value="<%= term.end_date.toISOString().slice(0, 10) %>">
                        </div>
                    </div>
                </fieldset>
            <% }); %>
            <button type="submit">Save Changes</button>
            <a href="#" onclick="deleteSchoolYear(<%= year.id %>)">Delete</a>

        </form>
    <% }); %>

    <h1>Manage Events</h1>
    <% events.forEach(function(event) { %>
        <form action="/common/updateEvent" method="post">
            <input type="hidden" name="id" value="<%= event.id %>">
            <input type="text" name="name" value="<%= event.name %>">
            <input type="date" name="event_date" value="<%= event.event_date.toISOString().split('T')[0] %>">
            <textarea name="details"><%= event.details %></textarea>
            <button type="submit">Save</button>
            <a href="#" onclick="deleteEvent(<%= event.id %>)">Delete</a>
        </form>
    <% }); %>



    <h1>Manage Announcements</h1>
    <% announcements.forEach(function(announcement) { %>
        <form action="/common/updateAnnouncement" method="post">
            <input type="hidden" name="announcementId" value="<%= announcement.announcement_id %>">
            <textarea name="message"><%= announcement.message %></textarea>
            <button type="submit">Save</button>
            <a href="#" onclick="deleteRecord('announcement', <%= announcement.announcement_id %>)">Delete</a>
        </form>
    <% }); %>
    

    <script>
        function deleteRecord(type, id) {
            const bodyData = {};
            if (type === 'announcement') {
                bodyData.announcementId = id;
            } else {
                bodyData.id = id;
            }
        
            if (confirm('Are you sure you want to delete this ' + type + '?')) {
                fetch(`/common/delete${type.charAt(0).toUpperCase() + type.slice(1)}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bodyData)
                })
                .then(response => response.json())
                .then(data => {
                    if(data.success) {
                        alert('Deleted successfully!');
                        window.location.reload(); // Reload the page to see the changes
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Failed to delete:', error);
                    alert('Failed to delete due to an error.');
                });
            }
        }
        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                fetch(`/common/deleteEvent`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ eventId: eventId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Event deleted successfully!');
                        window.location.reload();
                    } else {
                        alert('Deletion failed: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Deletion error:', error);
                    alert('Failed to delete due to an error.');
                });
            }
        }
            function deleteSchoolYear(yearId) {
                if (confirm('Are you sure you want to delete this school year?')) {
                    fetch('/common/deleteSchoolYear', {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id: yearId })
                    }).then(() => {
                        window.location.reload();
                    });
                }
            }
    
            function deleteTerm(termId) {
                if (confirm('Are you sure you want to delete this term?')) {
                    fetch('/common/deleteTerm', {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ term_id: termId })
                    }).then(() => {
                        window.location.reload();
                    });
                }
            }
        
        </script>
        
    
</body>
