<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mark Attendance for <%= className %></title>
    <link rel="stylesheet" href="/styles/main.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Mark Attendance for <%= className %></h1>
    <table>
        <thead>
            <tr>
                <th>Student Name</th>
                <% dates.forEach(date => { %>
                    <th><%= date %><br><a href="#" onclick="saveAttendanceForDate('<%= date %>')">Save</a></th>
                <% }); %>
            </tr>
        </thead>
        <tbody>
            <% students.forEach(student => { %>
                <tr>
                    <td><%= student.first_name %> <%= student.last_name %></td>
                    <% dates.forEach(date => { %>
                        <td>
                            <input type="checkbox" data-student-id="<%= student.student_id %>" data-date="<%= date %>"
                                   <%= (attendanceMap[student.student_id] && attendanceMap[student.student_id][date] === 'Present') ? 'checked' : '' %>>
                        </td>
                    <% }); %>
                </tr>
            <% }); %>
        </tbody>
    </table>

    <script>
        function saveAttendanceForDate(date) {
            const checkboxes = document.querySelectorAll(`input[data-date='${date}']`);
            const attendanceData = [];

            checkboxes.forEach(checkbox => {
                attendanceData.push({
                    studentId: checkbox.dataset.studentId,
                    date: date,
                    status: checkbox.checked ? 'Present' : 'Absent'
                });
            });

            axios.post('/common/saveAttendanceForDate', { attendance: attendanceData })
                .then(response => {
                    alert(`Attendance for ${date} saved successfully!`);
                })
                .catch(error => {
                    console.error('Error saving attendance:', error);
                    alert('Failed to save attendance. Please try again.');
                });
        }
    </script>
</body>
</html>
